angular.module("ui.colorpicker",[]).directive("colorPicker",["$compile","localize","$timeout",function(o,e,r){return{restrict:"EA",scope:{setColor:"&"},link:function(t,l,c){function n(){var o=h(l);P.css(o)}function i(){return angular.isDefined(c.disabled)?!c.disabled:!0}function a(o){t.$emit("colorPicked",o),t.hoveredColor=o,b(o),t.latestColor=k()}function s(o){a(o),f()}function d(o){t.hoveredColor=o}function f(){P.css("display","none")}function p(o,e){if(!angular.isArray(e))return-1;var r=-1;return angular.forEach(e,function(e,t){return e===o?r=t:void 0}),r}function u(o){var e=i(),c=t.setColor();if(e){o.stopPropagation();var n=p(c,t.latestColor||[]);0!==n&&r(function(){a(c)});var s=h(l);P.css(s),P.css("display","block")}}function v(o){o.stopPropagation()}function g(){var o=document.createElement("input");return o.setAttribute("type","color"),"text"!==o.type}function m(){var o=window.localStorage.getItem("ui-color-picker");if(!o)return null;try{o=JSON.parse(o)}catch(e){return null}return o}function k(){var o=m();return o?o.latestColor:[]}function b(o){o||(o="");var e=m()||{},r=k();if(r&&r instanceof Array){var t=r.indexOf(o);-1!=t&&r.splice(t,1),r.unshift(o)}else r=[o];r.length>10&&(r=r.slice(0,10)),e.latestColor=r,window.localStorage.setItem("ui-color-picker",JSON.stringify(e))}function C(o,e){for(var r=0,t=0,l=0,c=0;o&&!isNaN(o.offsetLeft)&&!isNaN(o.offsetTop);)r+=o.offsetLeft,t+=o.offsetTop,e||"BODY"!==o.tagName?(l+=o.scrollLeft,c+=o.scrollTop):(l+=document.documentElement.scrollLeft||o.scrollLeft,c+=document.documentElement.scrollTop||o.scrollTop),o=o.offsetParent;return{top:t,left:r,scrollX:l,scrollY:c}}function h(o){var e,r=C(o[0]);return"top"===_?e={top:r.top-147,left:r.left}:"right"===_?e={top:r.top,left:r.left+126}:"bottom"===_?e={top:r.top+o[0].offsetHeight+2,left:r.left}:"left"===_&&(e={top:r.top,left:r.left-150}),{top:e.top+"px",left:e.left+"px"}}var w=t.setColor()||"transparent",O={clearText:e.get("default_color"),defaultColor:w,latestText:e.get("latest_used"),commonText:e.get("theme_color"),commonColor:[["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646"],["#f2f2f2","#808080","#ddd8c2","#c6d9f1","#dbe5f1","#f2dbdb","#eaf1dd","#e5dfec","#daeef3","#fde9d9"],["#d9d9d9","#595959","#c4bc96","#8db3e2","#b8cce4","#e5b8b7","#d6e3bc","#ccc0d9","#b6dde8","#fbd4b4"],["#bfbfbf","#404040","#938953","#548dd4","#95b3d7","#d99594","#c2d69b","#b2a1c7","#92cddc","#fabf8f"],["#a6a6a6","#262626","#4a442a","#17365d","#365f91","#943634","#76923c","#5f497a","#31849b","#e36c0a"],["#7f7f7f","#0d0d0d","#1c1a10","#0f243e","#243f60","#622423","#4e6128","#3f3151","#205867","#974706"]],standardText:e.get("standard_color"),standardColor:["#c00000","#ff0000","#ffc000","#ffff00","#92d050","#00b050","#00b0f0","#0070c0","#002060","#7030a0"],moreText:e.get("more_color")},x=(1e6*+new Date+Math.floor(1e6*Math.random())).toString(36),y='<div class="colorpicker-container" tabindex="-1" ng-click="keepPickerOpen($event)"><div class="colorpicker-toolbar"><div class="colorpicker-preview" ng-style="{ \'background-color\': hoveredColor }"></div><div class="colorpicker-clear" ng-bind="defaultOptions.clearText" ng-click="selectColorAndClose(transparent)"></div></div><div class="colorpicker-title" ng-bind="defaultOptions.latestText" ng-if="latestColor.length > 0"></div><div class="colorpicker-latestcolor colorpicker-colors"><span class="colorpicker-colors-item" ng-repeat="color in latestColor" ng-style="{\'background-color\': color, \'border-color\': color}" ng-click="selectColorAndClose(color||\'\')" ng-mouseover="previewColor(color||\'\')" ng-mouseleave="previewColor(setColor() || defaultOptions.defaultColor)"></span></div><div class="colorpicker-title" ng-bind="defaultOptions.commonText"></div><div class="colorpicker-commoncolor"><div class="colorpicker-colors colorpicker-colors-line{{$index}}" ng-repeat="line in defaultOptions.commonColor"><span class="colorpicker-colors-item" ng-repeat="color in line" ng-style="{\'background-color\': color, \'border-color\': color}" ng-click="selectColorAndClose(color)" ng-mouseover="previewColor(color)" ng-mouseleave="previewColor(setColor() || defaultOptions.defaultColor)"></span></div></div><div class="colorpicker-title" ng-bind="defaultOptions.standardText"></div><div class="colorpicker-standardcolor colorpicker-colors"><span class="colorpicker-colors-item" ng-repeat="color in defaultOptions.standardColor" ng-style="{\'background-color\': color, \'border-color\': color}" ng-click="selectColorAndClose(color)" ng-mouseover="previewColor(color)" ng-mouseleave="previewColor(setColor() || defaultOptions.defaultColor)"></span></div><div class="colorpicker-title colorpicker-morecolor" ng-if="isSupportNativeColorPicker"><label for="native-color-picker'+x+'" ng-bind="defaultOptions.moreText"></label><input id="native-color-picker'+x+'" class="native-color-picker" type="color" ng-model="nativeColor" ng-change="selectColor(nativeColor);" /></div></div>',T=angular.element,P=T(y),_=angular.isDefined(c.colorpickerPosition)?c.colorpickerPosition:"bottom";t.defaultOptions=O,t.isSupportNativeColorPicker=g(),t.latestColor=k()||[],t.selectColor=a,t.previewColor=d,t.selectColorAndClose=s,t.keepPickerOpen=v,t.hoveredColor=O.defaultColor,o(P)(t),T(document.body).append(P);var L="INPUT"===l[0].tagName?"input click":"click";l.on(L,u),T(document).on("click",f),t.$on("openColorPicker",u),t.$on("closeColorPicker",f),window.attachEvent?window.attachEvent("onresize",n):window.addEventListener&&window.addEventListener("resize",n)}}}]),angular.module("ui.colorpicker").provider("localize",function(){this.map={"zh-cn":{default_color:"清除颜色",latest_used:"最近使用",theme_color:"主题颜色",standard_color:"标准颜色",more_color:"更多颜色.."},"en-us":{default_color:"default",latest_used:"latest used",theme_color:"theme color",standard_color:"standard color",more_color:"more.."}},this.defaultLang="zh-cn",this.setDefaultLang=function(o){var e=Object.keys(this.map);return-1===e.indexOf(o)?void console.error("Unsupported language: ",o,", please choose in :",e.join(", ")):void(this.defaultLang=o)},this.$get=function(){var o=this;return{get:function(e){return o.map[o.defaultLang].hasOwnProperty(e)?o.map[o.defaultLang][e]:(console.warn("Missing lang pair for : ",e),"")}}}});